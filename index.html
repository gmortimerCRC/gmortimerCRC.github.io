<!DOCTYPE html>
<html>
  <head>
    <title>Workspaces Demo TEST!</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="styles.css" />
    <script src="script.js" defer></script>
  </head>

  <header>
  </header>

  <section>
  </section>
  <body>
    <h1>Demographic Tool - 2016 StatsCan - DEMO -</h1>
<p>This tool is meant to expidite searching for key demographic data on specific Canadian regions</p>
<p>Input values must be in the form of the Canadian </p><a href="https://www150.statcan.gc.ca/n1/pub/92f0138m/92f0138m2019001-eng.htm">Geographic Unique Identifier (GEOUID)</a>
<p>Multiple regions of the same format can be submitted in comma seperated vales (555,221,312)</p>
    <p>
      <select id="scripts" name="scripts">
          <option value="A0003">Census division</option>
          <option value="A0005">Census subdivision</option>
          <option value="A0011">Forward sortation area</option>
          <option value="S0503">Census metropolitan area</option>
          <option value="S0512">Dissemination area</option>
          <option value="S0516">Aggregate Dissemination Area</option>
      </select>
      <input type="text" id="DAnameID"><br><br>
  </p>
    
    
    <input type="button" id="myForm" value="Submit" onclick="myFunction()">

    <div style="overflow-x:auto;">
    <table id="my-table">
      <tr id="table-header"><td>Province</td><td>Population</td><td>Average Age</td><td>Median total income (2015)</td>><td>65 Years and Older</td><td>English Speaking</td><td>French Speaking</td><td>Aboriginal Identifying</td></tr>
    </table>
  </div>
  </body>
  <script>

    function myFunction() {


     var InputDA = document.getElementById("DAnameID").value;
     var InputDaArr= InputDA.split(',');
     var InputRegion= document.getElementById("scripts");

     for (const InputValue of InputDaArr){
    console.log(InputValue);


    const header = document.querySelector('header');
    const section = document.querySelector('section');

    let requestURL =  'https://www12.statcan.gc.ca/rest/census-recensement/CPR2016.json?lang=E&dguid=2016'+ InputRegion["value"]+ InputValue +'&topic=0&notes=0&stat=0';
    let request = new XMLHttpRequest();
    request.open('GET', requestURL);
    request.responseType = 'text';
    request.send();

    request.onload = function() {
        const PopulationData = request.response;
        const NewPopData = PopulationData.replace('//','')
        const JsonPopData = JSON.parse(NewPopData)
        populateHeader(JsonPopData);
        //showHeroes(JsonPopData);
}

function populateHeader(jsonObj) {
  let tableRef = document.getElementById('my-table');
  let newRow = tableRef.insertRow(-1);

  const myH1 = document.createElement('p');
  myH1.textContent = jsonObj.DATA[0][1];
  //header.appendChild(myH1);

  const myPara = document.createElement('p');
  myPara.textContent =  jsonObj.DATA[0][13];
  //header.appendChild(myPara);

  const myPara2 = document.createElement('p');
  myPara2.textContent = jsonObj.DATA[38][13];
  //header.appendChild(myPara2);

  const myPara3 = document.createElement('p');
  myPara3.textContent = jsonObj.DATA[741][13];
  //header.appendChild(myPara3);

  const myPara4 = document.createElement('p');
  var PopOver65 = Math.round(100*(jsonObj.DATA[23][13]/jsonObj.DATA[0][13]))
  myPara4.textContent =  PopOver65 + ' %';
  //header.appendChild(myPara4);

  const myPara5 = document.createElement('p');
  var EnglishPerc = Math.round(100*(jsonObj.DATA[105][13]/jsonObj.DATA[0][13]))
  myPara5.textContent = EnglishPerc + ' %';
 // header.appendChild(myPara5);

  const myPara6 = document.createElement('p');
  var FrenchPerc = Math.round(100*(jsonObj.DATA[106][13]/jsonObj.DATA[0][13]))
  myPara6.textContent = FrenchPerc + ' %';
  //header.appendChild(myPara6);

  const myPara7 = document.createElement('p');
  var IndegPerc = Math.round(100*(jsonObj.DATA[1289][13]/jsonObj.DATA[0][13]))
  myPara7.textContent =  IndegPerc + ' %';
  //header.appendChild(myPara7);

  let newCell = newRow.insertCell(0);
  newCell.appendChild(myH1);
  let newCell2 = newRow.insertCell(1);
  newCell2.appendChild(myPara);
  let newCell3 = newRow.insertCell(2);
  newCell3.appendChild(myPara2);
  let newCell4 = newRow.insertCell(3);
  newCell4.appendChild(myPara3);
  let newCell5 = newRow.insertCell(4);
  newCell5.appendChild(myPara4);
  let newCell6 = newRow.insertCell(5);
  newCell6.appendChild(myPara5);
  let newCell7 = newRow.insertCell(6);
  newCell7.appendChild(myPara6);
  let newCell8 = newRow.insertCell(7);
  newCell8.appendChild(myPara7);

}


    }
    }
  </script>
</html>
